\subsection{Introducción}

```{r, echo=FALSE, results='hide', cache=TRUE}
load(popstudy::read_from_dir("Resultados simulaciones.RData", "Output/Results"))
```

La metodología propuesta será puesta a prueba en una primera etapa con series cronológicas simuladas a partir de distintos modelos. Los resultados obtenidos al utilizar la sobreparametrización serán contrastados con otros dos métodos: La función `auto.arima()` de R y un modelo ARIMA estándar, que se trata de un $ARIMA(1,1,1)$ en el caso de series no estacionales, y un $ARIMA(1,1,1)(1,1,1)_{12}$ sobre los datos simulados de series mensuales.

De forma similar, en la segunda parte de este capítulo se comparan los resultados obtenidos mediante la sobreparametrización con los obtenidos utilizando la función `auto.arima()` de R, aplicado a series cronológicas costarricenses.

Los paquetes utilizados para la obtención de estos resultados, aparte de los ya mencionados, son `knitr` [@knitr], `kableExtra` [@kableExtra], `readxl` [@readxl], `gridExtra` [@gridExtra], `ggpubr` [@ggpubr], `ggplot2` [@ggplot2], `lubridate` [@lubridate], `ggseas` [@ggseas], `ggpmisc` [@ggpmisc] y `forecast` [@forecast].

\subsection{Análisis de simulación en series cronológicas}

Como se mencionó en el capítulo anterior, se utiliza la función \ref{simula_series} para generar las distintas series cronológicas que evaluarán el método. El primer insumo de esta función consiste en una muestra de valores aleatorios; en este caso se seleccionaron 100 valores de una distribución $N(10,1)$ para generar series de 200 observaciones. Los valores paramétricos de los modelos ARIMA fueron seleccionados de manera aleatoria. Los valores iniciales para obtener las series cronológicas simuladas se resumen en la figura \ref{fig:datos_simulados}; donde las región azul oscuro representa la densidad de datos entre los percentiles 25 y 75, las líneas punteadas de color naranja marcan la cantidad de desviaciones estándar que los datos se alejan del promedio, y las líneas punteadas de color azul marcan los puntos de corte mínimo, percentiles 25, 50 y 75, y el máximo. 

```{r datos_simulados, fig.cap="Valores de referencia para la simulación de series cronológicas"}
popstudy::descriptive_plot(data = data.frame(Xt=dat), labels = NULL, Xt)$Xt
```

Por su lado, se simularon un total de ocho series cronológicas, cuyo comportamiento y proceso gobernante se muestran en la figura \ref{fig:series_simuladas}.

```{r series_simuladas, fig.cap="Series cronológicas simuladas"}
arima100 <- resultados_no_estacional_bajo[[1]]$datos %>% 
    ggplot(.)+
  geom_line(color = "#00AFBB", size = .5) +
  # stat_smooth(color = "#FC4E07", fill = "#FC4E07",
  #             method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
    ggtitle("ARIMA(1,0,0)")+
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Datos simulados",
       y="Y",
       x="t") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))

arima101 <- resultados_no_estacional_bajo[[2]]$datos %>% 
    ggplot(.)+
  geom_line(color = "#00AFBB", size = .5) +
  # stat_smooth(color = "#FC4E07", fill = "#FC4E07",
  #             method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
    ggtitle("ARIMA(1,0,1)")+
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Datos simulados",
       y="Y",
       x="t") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))

arima203 <- resultados_no_estacional_alto[[1]]$datos %>% 
    ggplot(.)+
  geom_line(color = "#00AFBB", size = .5) +
  # stat_smooth(color = "#FC4E07", fill = "#FC4E07",
  #             method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
    ggtitle("ARIMA(2,0,3)")+
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Datos simulados",
       y="Y",
       x="t") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))

arima402 <- resultados_no_estacional_alto[[2]]$datos %>% 
    ggplot(.)+
  geom_line(color = "#00AFBB", size = .5) +
  # stat_smooth(color = "#FC4E07", fill = "#FC4E07",
  #             method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
    ggtitle("ARIMA(4,0,2)")+
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Datos simulados",
       y="Y",
       x="t") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))

arima001_011 <- resultados_estacional_bajo[[1]]$datos %>% 
    ggplot(.)+
  geom_line(color = "#00AFBB", size = .5) +
  # stat_smooth(color = "#FC4E07", fill = "#FC4E07",
  #             method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
    ggtitle("ARIMA(0,0,1)(0,1,1)")+
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Datos simulados",
       y="Y",
       x="t") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))

arima110_110 <- resultados_estacional_bajo[[2]]$datos %>% 
    ggplot(.)+
  geom_line(color = "#00AFBB", size = .5) +
  # stat_smooth(color = "#FC4E07", fill = "#FC4E07",
  #             method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
    ggtitle("ARIMA(1,1,0)(1,1,0)")+
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Datos simulados",
       y="Y",
       x="t") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))

arima214_414 <- resultados_estacional_alto[[1]]$datos %>% 
    ggplot(.)+
  geom_line(color = "#00AFBB", size = .5) +
  # stat_smooth(color = "#FC4E07", fill = "#FC4E07",
  #             method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
    ggtitle("ARIMA(2,1,4)(4,1,4)")+
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Datos simulados",
       y="Y",
       x="t") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))

arima214_303 <- resultados_estacional_alto[[2]]$datos %>% 
    ggplot(.)+
  geom_line(color = "#00AFBB", size = .5) +
  # stat_smooth(color = "#FC4E07", fill = "#FC4E07",
  #             method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
    ggtitle("ARIMA(2,1,4)(3,0,3)")+
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Datos simulados",
       y="Y",
       x="t") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))+
    scale_x_discrete()
ggarrange(arima100, arima101, arima203, arima402,
          arima001_011, #arima110_110, 
          arima214_303, #arima214_414,
          ncol = 3, nrow = 2)
```

El cuadro \ref{tab:comparaciones} muestra los valores del MAE, MASE y RMSE para cada proceso estimado y, además, muestra el proceso de origen de las series cronológicas simuladas. Al aplicar la función `auto.arima()` y la sobreparametrización sobre una serie cronológica generada a partir de un $ARIMA(1,0,0)$, se obtienen los mismos resultados, y esto son ligeramente inferiores a los obtenidos mediante un $ARIMA(1,1,1)$. Al generar datos a partir de un $ARIMA(1,0,1)$ los mejores pronósticos se obtienen tanto con el `auto.arima()` como con la sobreparametrización, pues ambos son superiores a los obtenidos mediante un $ARIMA(1,1,1)$. Al ir incorporando términos en las series no estacionales, como es el caso de los datos simulados a partir de un $ARIMA(2,0,3)$, los mejores pronósticos se obtienen mediante el uso de la sobreparametrización, pues la magnitud de sus errores son siempre menores. 

Cuando se consideran series cronológicas estacionales, se presenta un comportamiento similar a lo previamente descrito. Al tener una baja cantidad de parámetros en los datos simulados de un proceso estacional $ARIMA(0,0,1)(0,1,1)_{12}$, la sobreparametrización iguala los resultados obtenidos mediante la función `auto.arima()`; y además, cuando se incorporan más parámetros al modelo generador de los dato como en el caso del $ARIMA(2,1,4)(3,0,3)_{12}$, la sobreparametrización logra captar de mejor manera el comportamiento de los datos, obteniendo así menores mediciones del error, es decir, los pronósticos se acercan más a los datos reales. 

```{r}
comparaciones %>% 
    mutate(original=ifelse(modelo=="original", proceso, NA),
           original=zoo::na.locf(original)) %>% 
    na.omit() %>% 
    select(original, modelo:RMSE) %>% 
    data.frame(row.names = NULL) %>%
    mutate(modelo=recode(modelo,
                         "autoarima"="auto.arima",
                         "sobreparametrizacion"="Sobreparametrización",
                         "arima_estandar"="ARIMA estándar")) %>% 
    # group_by(original) %>% 
    # mutate_at(vars(MAE, MASE, RMSE), function(x){
    #     cell_spec(x, "latex",align = "r", color=ifelse(x==min(x), "blue", "black"))
    # }) %>% 
    kbl(., "latex", booktabs=T,escape = F, align = "r", caption="\\label{tab:comparaciones}Medidas de rendimiento según método de estimación", col.names = c("Proceso original", "Método", "Proceso", "MAE", "MASE", "RMSE")) %>%
    kable_styling(latex_options = c("scale_down", "repeat_header", "hold_position"), full_width = T, font_size = 5) %>% 
    column_spec(1, width = "2.5cm") %>%
    collapse_rows(columns = 1:2) %>% 
    column_spec(2, width = "2.5cm")

#cell_spec(cs_dt$mpg, color = ifelse(cs_dt$mpg > 20, "red", "blue")
```

\subsection{Estimaciones en series cronológicas costarricenses reales}

```{r, eval=FALSE}
#En el campo demográfico, por ejemplo, las estadísticas vitales son sistematizadas y divulgadas año tras año, por tanto, revelan los cambios acontecidos durante este periodo. Esta información junto con la proveniente de los censos de población constituye la base para construir los diferentes índices, tasas y otros indicadores que revelan la situación demográfica del país, información de gran relevancia para la planificación nacional, regional y local en diversos campos. Uno de estos principales campos de acción es la salud pública, para la cual la tasa de mortalidad infantil se considera uno de los indicadores prioritarios dado que refleja no solo las condiciones de salud de la población infante, sino también los niveles de desarrollo del país, pues depende de la calidad de la atención de la salud, principalmente de la prenatal y perinatal, así como de las condiciones de saneamiento. Por tanto, su continuo monitoreo es fundamental para diseñar, implementar y evaluar políticas de salud pública orientadas a disminuir y erradicar aquellas que son prevenibles [@calidad_vitales].
```


\subsubsection{Tasa de mortalidad infantil interanual}

La Tasa de Mortalidad Infantil (TMI) es uno de los indicadores demográficos más importantes, pues es utilizado como un parámetro de referencia sobre la calidad del sistema de salud, tanto a nivel nacional como regional. Si bien este indicador se construye relacionando las defunciones de menores de un año con el total de nacimientos, también involucra de manera implícita otras condiciones tales como las económicas, sociales y culturales, así como la efectividad en los métodos preventivos y curativos de esta categoría poblacional [@leon]. Debido a esto, el fallecimiento de un niño menor de un año se traduce en una falla del sistema de salud, por lo que estos casos son sujetos de estudio con el fin de conocer las causas que desencadenaron el evento. 

En algunos países en vías de desarrollo de Asia, África y América Latina, la mortalidad infantil alcanza valores elevados pues la desnutrición, ausencia de asistencia médica y mala calidad de las condiciones sanitarias son, a diferencia de los países más desarrollados, algo muy común [@donoso]. En el caso de Costa Rica, la unidad de estadísticas demográficas del Instituto Nacional de Estadística y Censos[^9] (INEC) es el ente encargado de reportar este indicador con el fin de dar seguimiento y control al comportamiento del mismo a lo largo del tiempo con el objetivo de llegar a los niveles más bajos posibles. 

[^9]: http://www.inec.go.cr/

En el INEC, cada mes se publica el boletín de la TMI interanual (TMII), que analiza la TMI de un mes y los 11 meses previos para comparar los periodos correspondientes [@infantiles]. Este apartado busca hacer un análisis de la TMII para los 12 periodos desde el año 1989 y hasta 2017, y no de manera mensual simple, pues dada la volatilidad del fenómeno de estudio, hacer un estudio interanual permite analizar de una mejor manera los cambios entre periodos. Es decir, se analizará la TMII desde el periodo Febrero 1989 – Enero 1990 hasta el periodo Enero 2017 – Diciembre 2017.

La importancia de este proceso, aparte de servir de parámetro para evaluar el sistema de salud, está en su estrecha relación con las proyecciones de población, pues como se mencionó previamente, la TMII analiza la mortalidad en el grupo de edad de menores de un año, que es el primer grupo al generar tablas de mortalidad, ya sea de la forma clásica o mediante la mortalidad óptima [@mortalidad_optima]. Uno de los métodos más conocidos para realizar estas estimaciones es el método de los componentes de cambio demográfico, que son la fecundidad, la mortalidad y la migración. En el caso de la mortalidad, uno de los puntos de partida es la estimación de las tasas de mortalidad por grupos de edad, siendo de particular interés la de menores de cinco años, pues esta a su vez se subdivide en los grupos de menores de un año y el de uno a cuatro años. Conocer el comportamiento de la mortalidad infantil es importante porque es en este grupo de edad en el que pueden existir cambios muy bruscos en la mortalidad y la fecundidad [@Rincon].

Dado que la medición de la TMII se hace partiendo de un determinado mes y a partir de éste se consideran los 11 meses anteriores, el primer valor de la base de datos fue medido a partir de Enero de 2000, que corresponde al período interanual Febrero 1999 – Enero 2000. Todos los periodos siguientes se muestran en la figura \ref{fig:tmiiplotgeneral}.

```{r}
base <- popstudy::read_from_dir("TMIIR.xlsx", "References/Results_section_references/01 - Tasa de mortalidad infantil interanual") %>% 
  read_excel()
#base <- read_excel("./Material de referencia/Para sección de resultados/01 - Tasa de mortalidad infantil interanual/TMIIR.xlsx")
TS <- ts(base$tmii, start = c(1989, 1), end = c(2017, 12), frequency = 12)
```

```{r tmiiplotgeneral, fig.cap="Tasa de Mortalidad Infantil Interanual 1989 - 2017"}
#Se requiere el paquete ggpmisc
ggplot(TS)+
  geom_line(color = "#00AFBB", size = 1.3) +
  stat_smooth(color = "#FC4E07", fill = "#FC4E07",
              method = "loess")+
  geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC",
       y="TMII (por cada 1000 nacimientos)",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_discrete(expand = c(0,0), limits=c(1995, 2005, 2015))
```

La serie muestra picos y valles pronunciados a lo largo de todo el periodo. A modo de visualización, se ajustó un suavizamiento de Loess para buscar señales de tendencia y concavidad en los datos temporales. La línea roja punteada se ubica aproximadamente en el mes de Julio del año 2000, pues a partir de ese punto el suavizamiento de Loess muestra un ligero cambio en la concavidad, lo cual sugiere que a partir ese punto será más difícil que la TMII vuelva a alcanzar valores similares a los mostrados al inicio de la serie. Además, al presentarse dos caídas y subidas abruptas en la TMII, esta tiende a estabilizarse.

Mediante un análisis visual, la figura \ref{fig:tmiiplotperiodos} parece respaldar el supuesto de que la mortalidad no posee efectos estacionales determinantes, pues para cada uno de los 12 períodos, en ninguno parecen existir mayores diferencias. El efecto que se mantiene en cada uno de los períodos es el de la tendencia, pues en cada uno ésta sigue descendiendo con el pasar de los años. Este hecho coincide con lo observado en la figura \ref{fig:tmiiplotgeneral}.

```{r tmiiplotperiodos, fig.cap="Tasa de Mortalidad Infantil Interanual 1989 - 2017 según periodos"}
base %>% 
  group_by(año=year(fecha), mes=month(fecha, label = TRUE, abbr=FALSE)) %>% 
  summarise(tmii) %>% 
  mutate(mes=factor(mes, labels=c("Febrero - Enero", "Marzo - Febrero",
                                  "Abril - Marzo", "Mayo - Abril", 
                                  "Junio - Mayo", "Julio - Junio",
                                  "Agosto - Julio", "Setiembre - Agosto",
                                  "Octubre - Setiembre", "Noviembre - Octubre",
                                  "Diciembre - Noviembre", "Enero - Diciembre"))) %>% 
  ggplot(., aes(x=año, y=tmii)) +
  facet_wrap(.~mes, ncol=3) +
  geom_line(color = "#00AFBB", size = 1.3) +
  stat_peaks(colour = "red") +
  stat_peaks(geom = "text", colour = "red", 
             vjust = -0.5) +
  stat_valleys(colour = "blue") +
  stat_valleys(geom = "text", colour = "blue", angle = 20,
               vjust = 0.1, hjust = 1) +
  theme_minimal() +
  theme(text = element_text(size=13),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC",
       y="TMII (por cada 1000 nacimientos)",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_discrete(expand = c(0,0), limits=c(2005, 2010, 2015))
```

Para hacer la descomposición de la serie se hizo una transformación de Box-Cox con $\lambda=1$ para aplicarla de manera multiplicativa. Esto se debe a que en la figura \ref{fig:tmiiplotgeneral} pueden observarse cambios considerables en la variabilidad de la serie a lo largo del tiempo. la figura \ref{fig:tmiiplotdescomposicion} muestra, como se mencionó previamente, una tendencia decreciente y una estacionalidad que no es reiterada a lo largo del tiempo. Además, el componente aleatorio muestra como los errores no son constantes durante todo el período.

```{r tmiiplotdescomposicion, fig.cap="Descomposición de la TMII en el periodo 2000 - 2017"}
base %>% 
  mutate(tmii=BoxCox(tmii, lambda=1)) %>% 
ggsdc(., aes(x = fecha, y = tmii),
         method = "stl", s.window = 7, frequency = 12, type="multiplicative",
         facet.titles = c("Serie Original", "Tendencia", 
                          "Estacionalidad", "Aleatoria")) +
      geom_line(color = "#00AFBB", size = 1.3) +
  labs(x = "", y = "") +
  theme_minimal() +
  theme(text = element_text(size=13),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))
```

Tras tener un panorama más claro del comportamiento de la serie mediante el análisis descriptivo anterior, se modela la serie mediante la función `auto.arima()`, teniendo como mejor modelo un $ARIMA(2,1,0)(0,0,1)$; y utilizando la sobreparametrización se tiene como mejor modelo un $ARIMA(4,1,0)(4,1,0)$. El cuadro \ref{tab:tmiimedidas} muestra como el uso de la sobreparametrización ofrece pronósticos más cercanos al valor real, y aunque los pronósticos están lejos de ser perfectos, el método propuesto logra reproducir de mejor manera el comportamiento de los datos, tal y como se muestra en la figura \ref{fig:tmiiplotpronostico}

```{r}
resumen_resultados(TMII, fecha_inicio = '2012-03-01', fecha_fin = '2017-12-01')$medidas %>% 
  kbl(., "latex", booktabs=T, escape = F, align = "r", caption="\\label{tab:tmiimedidas}Medidas de rendimiento según método de estimación para la TMII", col.names = c("Método", "RMSE", "MAE", "MAPE")) %>%
    kable_styling(latex_options = c("scale_down", "repeat_header", "hold_position"), 
                  full_width = T#, font_size = 5
                  )
```

```{r tmiiplotpronostico, fig.cap="Pronósticos de la TMII según método de estimación"}
resumen_resultados(TMII, fecha_inicio = '2012-03-01', fecha_fin = '2017-12-01')$pronostico %>% 
  rename("Método"=Serie) %>% 
  #filter(Serie %in% c("Original", "Arima")) %>% 
  ggplot(., aes(x=fecha, y=valor, colour=Método))+
  geom_line(size = 0.8)+
  scale_color_manual(values=c("limegreen", "orangered1", "blue"))+
  #geom_ribbon(aes(x=fecha, ymin=LIred, ymax=LSred), fill="green", linetype=0, alpha=0.2)+
  theme_minimal() +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC",
       y="TMII (por cada 1000 nacimientos)",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_date(expand = c(0,0))+
  scale_y_continuous(expand=c(0, 0))
```

\subsubsection{Mortalidad por causa externa}

La violencia es un acto tan antiguo como el mundo, sin embargo, la evolución de esta en conjunto con el crecimiento de su relación con las defunciones registradas en una población la vuelven un problema de salud pública. En base a la clasificación Internacional de Enfermedades [@CIE10] de la de la Organización Mundial de la Salud[^10], las defunciones pueden clasificarse en cuatro grandes grupos, siendo el más importante el de las causas naturales, el cual incluye enfermedades congénitas, cardiopatías u otras relacionadas con la vejez. En menor cuantía se encuentran las causas de muerte ignoradas, las cuales se dan cuando la causa de muerte es desconocida y de intención indeterminada; y de forma similar se encuentran las causas de muerte que se mantienen en estudio, bien sea por parte de la morgue o de algún otro organismo, esta última tiene pocos registros conforme más se retrocede en el tiempo.
  
El otro gran grupo, aunque considerablemente menor que las causas naturales, son las causas externas, las cuales son objeto de análisis en este apartado. Este grupo puede a su vez ser clasificado en homicidios, suicidios y las muertes accidentales, esta última comprende los accidentes de tránsito, las muertes por caídas, personas ahogadas, víctimas de incendios, terraplenes u otros similares. Aunado a estas categorías se encuentran también las causas indeterminadas, las cuales se diferencian a las ignoradas en que se sabe que se debe a una causa externa pero no se conoce con certeza a cuál categoría pertenece o aún está en investigación, tal es el caso de una persona que fallece debido a una alta ingesta de drogas o estupefacientes; bien pudo haber consumido intencionalmente hasta morir, lo cual sería un suicidio, o bien el consumo excesivo se debió a un accidente.

En Costa Rica para el año 2011, las muertes por causas externas ocuparon el tercer lugar, siendo solo superadas por las enfermedades del sistema circulatorio, en particular las enfermedades cardiovasculares, y los tumores, ambos casos mostraron una tendencia ascendente [@nacion]. Es debido a los elevados costos económicos y sociales [@ccpexternas] que se aborda la imperiosa necesidad comprender el comportamiento de las defunciones debido a las causas externas con el fin de contar con un punto de partida para la elaboración de políticas públicas que busquen reducir al mínimo este tipo de eventos.

[^10]: https://www.paho.org/salud-en-las-americas-2017/?lang=es]

Dado que los registros de defunciones por causa externa se realizan diariamente, conviene analizar su comportamiento de manera mensual desde inicios del milenio de una manera más general, dicho comportamiento puede observarse en la figura \ref{fig:externaplotgeneral}.

```{r}
load(popstudy::read_from_dir("data.RData", "References/Results_section_references/03 - Mortalidad por causa externa"))
TS <- ts(base$Total, start = c(2000, 1), end = c(2017, 12), frequency = 12)
```

```{r externaplotgeneral, fig.cap="Mortalidad por causa externa 2000 − 2017"}
#Se requiere el paquete ggpmisc
ggplot(TS)+
  geom_line(color = "#00AFBB", size = 1.3) +
  stat_smooth(color = "#FC4E07", fill = "#FC4E07",
              method = "loess")+
  #geom_vline(xintercept = 2000.6, linetype="dashed", color = "red")+
  theme_minimal() +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC",
       y="Mortalidad por causa externa (por cada 1000 habitantes)",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))# +
  #ylim(7,12) +
  #scale_x_discrete(expand = c(0,0), limits=c(1995, 2005, 2015))
```

Es importante recalcar que, entre Junio del año 2012 y Diciembre del año 2017, el aumento en la tasa de cambio de la cantidad de defunciones debido a causas externas coincide con el aumento de la flotilla de motocicletas, pues en un período de cinco años esta cifra creció en un 189% [@motos]. Conviene entonces verificar el comportamiento a lo interno de la serie en referencias a las categorías de las causas externas.

De la figura \ref{fig:externasplotperiodos} puede notarse que cada mes tiene sus picos y valles durante cada mes a lo largo del periodo, siendo los meses de Enero, Abril y Diciembre los que presentaron valores ligeramente más altos entre los años 2000 y 2017. 

```{r externasplotperiodos, fig.cap="Mortalidad por causa externa 2000 − 2017 según mes"}
base %>% 
  group_by(año=year(fecha), mes=month(fecha, label = TRUE, abbr=FALSE)) %>% 
  summarise(Total) %>% 
  ggplot(., aes(x=año, y=Total)) +
  facet_wrap(.~mes, ncol=3) +
  geom_line(color = "#00AFBB", size = 1.3) +
  stat_peaks(colour = "red") +
  stat_peaks(geom = "text", colour = "red", 
             vjust = -0.5) +
  stat_valleys(colour = "blue") +
  stat_valleys(geom = "text", colour = "blue", angle = 20,
               vjust = 0.1, hjust = 1) +
  theme_minimal() +
  theme(text = element_text(size=13),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC",
       y="Mortalidad por causa externa (por cada 1000 habitantes)",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_discrete(expand = c(0,0), limits=c(2005, 2010, 2015))
```

La descomposición de la serie se hará de forma aditiva debido a que en el gráfico 1 no se observan grandes cambios en la variabilidad a lo largo del tiempo. La figura \ref{fig:externasplotdescomposicion} muestra que la tendencia se mantiene casi constante a lo largo del tiempo, mientras que parece haber estacionalidad en ciertos lapsos de la segunda mitad del año. Además, el componente aleatorio muestra como los errores no son constantes a lo largo de todo el período. 

```{r externasplotdescomposicion, fig.cap="Descomposición de las defunciones por causa externa en el periodo 2000-2017"}
base %>% 
  mutate(valor=BoxCox(Total, lambda=1)) %>% 
ggsdc(., aes(x = fecha, y = Total),
         method = "stl", s.window = 7, frequency = 12, type="aditive",
         facet.titles = c("Serie Original", "Tendencia", 
                          "Estacionalidad", "Aleatoria")) +
      geom_line(color = "#00AFBB", size = 1.3) +
  labs(x = "", y = "") +
  theme_minimal() +
  theme(text = element_text(size=13),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))
```

De manera similar a lo hecho para pronosticar la TMII, se ajusta un modelo utilizando la función `auto.arima()`, siendo el modelo sugerido un $ARIMA(1,1,1)$; mientras que la sobreparametrización propone como mejor modelo un $ARIMA(2,0,1)(0,1,1)_{12}$. El cuadro \ref{tab:externasmedidas} muestra las medidas de rendimiento obtenidas de los pronósticos realizados con cada método, los cuáles son mejores al utilizar la sobreparametrización; este hecho también se observa gráficamente mediante la figura \ref{fig:externasplotpronostico}

```{r}
resumen_resultados(EXTERNA, fecha_inicio="2014-06-01", fecha_fin="2017-12-01")$medidas %>% 
  kbl(., "latex", booktabs=T, escape = F, align = "r", caption="\\label{tab:externasmedidas}Medidas de rendimiento según método de estimación para la Mortalidad por causa externa", col.names = c("Método", "RMSE", "MAE", "MAPE")) %>%
    kable_styling(latex_options = c("scale_down", "repeat_header", "hold_position"), 
                  full_width = T#, font_size = 5
                  )
```

```{r externasplotpronostico, fig.cap="Pronósticos de la TMII según método de estimación"}
resumen_resultados(EXTERNA, fecha_inicio="2014-06-01", fecha_fin="2017-12-01")$pronostico %>% 
  rename("Método"=Serie) %>% 
  #filter(Serie %in% c("Original", "Arima")) %>% 
  ggplot(., aes(x=fecha, y=valor, colour=Método))+
  geom_line(size = 0.8)+
  scale_color_manual(values=c("limegreen", "orangered1", "blue"))+
  #geom_ribbon(aes(x=fecha, ymin=LIred, ymax=LSred), fill="green", linetype=0, alpha=0.2)+
  theme_minimal() +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC",
       y="Mortalidad por causa externa (por cada 1000 habitantes)",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_date(expand = c(0,0))+
  scale_y_continuous(expand=c(0, 0))
```

\subsubsection{Incentivos salariales del sector público}

Los incentivos salariales son retribuciones que de conformidad con la legislación vigente se asignan al servidor por sus características laborales que complementan las remuneraciones básicas. Los incentivos se reconocen tanto a profesionales como a no profesionales, facultados por disposiciones jurídicas que así lo autorizan. Algunos de estos incentivos son: anualidades, dedicación exclusiva, salario escolar, carrera profesional, carrera técnica, zonaje, desarraigo, regionalización, riesgo policial, riesgo penitenciario, riesgo de seguridad y vigilancia, peligrosidad, incentivo didáctico, entre otros. Esta serie cronológica representa los incentivos salariales en millones de colones del sector público de Costa Rica de enero 2007 a junio 2015.

De manera análoga a las secciones anteriores, la figura \ref{fig:incentivosplotgeneral} muestra el comportamiento general de la serie cronológica. al hacer un suavizamiento Loess hay un ligero cambio de concavidad a partir de Julio 2008, lo cual sugiere que a partir de este momento los incentivos salariales vuelvan a alcanzar valores similares a los mostrados al inicio de la serie. La figura \ref{fig:incentivosplotperiodos} muestra cómo hay un crecimiento sostenido de los incentivos en cada mes a lo largo de todo el periodo. Sin embargo, este crecimiento se da a una tasa mucho mayor en la época de fin y principio de año.

```{r}
base <- popstudy::read_from_dir("Datos examen1.xlsx", "References/Results_section_references/04 - Incentivos salariales del sector público") %>% 
  read_excel() %>% 
  #read_excel(".\\Material de referencia\\Para sección de resultados\\04 - Incentivos salariales del sector público\\Datos examen1.xlsx") %>% 
  mutate(valor=`Incentivos salariales`,
         fecha=ymd(Fecha)) %>% 
  select(fecha, valor)
TS <- ts(base$valor, start = c(2007, 1), end = c(2015, 06), frequency = 12)
```

```{r incentivosplotgeneral, fig.cap="Incentivos salariales en el sector público 2007 − 2018"}
ggplot(TS)+
  geom_line(color = "#00AFBB", size = 1.3) +
  stat_smooth(color = "#FC4E07", fill = "#FC4E07",
              method = "loess")+
  theme_minimal() +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Contraloría General de la República de Costa Rica",
       y="Incentivos salariales",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))
```

```{r incentivosplotperiodos, fig.cap="Incentivos salariales en el sector público 2007 − 2018 según mes"}
base %>% 
  group_by(año=year(fecha), mes=month(fecha, label = TRUE, abbr=FALSE)) %>% 
  summarise(valor) %>% 
  ggplot(., aes(x=año, y=valor)) +
  facet_wrap(.~mes, ncol=3) +
  geom_line(color = "#00AFBB", size = 1.3) +
  stat_peaks(colour = "red") +
  stat_peaks(geom = "text", colour = "red", 
             vjust = -0.5) +
  stat_valleys(colour = "blue") +
  stat_valleys(geom = "text", colour = "blue", angle = 20,
               vjust = 0.1, hjust = 1) +
  theme_minimal() +
  theme(text = element_text(size=13),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC",
       y="Incentivos salariales",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_discrete(expand = c(0,0), limits=c(2005, 2010, 2015))
```

En la figura \ref{fig:incentivosplotdescomposicion} se muestra la descomposición de la serie en sus distintos componentes. Pueden observarse, además de un crecimiento a lo largo del tiempo, los picos y las caídas en la parte estacional, esto hace referencia a los meses de Diciembre y Enero; cuando no se está en este periodo los incentivos poseen un comportamiento más estable. El componente aleatorio muestra indicios de que la variabilidad de la serie no es homogénea, sino que cambia conforme pasa el tiempo.

```{r incentivosplotdescomposicion, fig.cap="Descomposición de la serie de Incentivos salariales en el periodo 2007 − 2018"}
base %>% 
  mutate(valor=BoxCox(valor, lambda=1)) %>% 
ggsdc(., aes(x = fecha, y = valor),
         method = "stl", s.window = 7, frequency = 12, type="multiplicative",
         facet.titles = c("Serie Original", "Tendencia", 
                          "Estacionalidad", "Aleatoria")) +
      geom_line(color = "#00AFBB", size = 1.3) +
  labs(x = "", y = "") +
  theme_minimal() +
  theme(text = element_text(size=13),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: UED-INEC") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))# +
  #scale_x_discrete(expand = c(0,0))
```

Nuevamente, se ajustaron dos modelos ARIMA, el primero de ellos mediante la función `auto.arima()`, siendo el modelo sugerido un $ARIMA(0,0,1)(1,1,0)_{12}$;y el segudo modelo sugerido, utilizando la sobreparametrización, es un $ARIMA(2,1,0)(1,2,0)_{12}$. Tanto el cuadro \ref{tab:incentivosmedidas} como la figura \ref{fig:incentivosplotpronostico} muestran que nuevamente los pronósticos obtenidos son superiores utilizando la sobreparametrización.

```{r}
resumen_resultados(INCENTIVOS, fecha_inicio="2013-11-01", fecha_fin="2015-06-01")$medidas %>% 
  kbl(., "latex", booktabs=T, escape = F, align = "r", caption="\\label{tab:incentivosmedidas}Medidas de rendimiento según método de estimación para los incentivos salariales", col.names = c("Método", "RMSE", "MAE", "MAPE")) %>%
    kable_styling(latex_options = c("scale_down", "repeat_header", "hold_position"), 
                  full_width = T#, font_size = 5
                  )
```

```{r incentivosplotpronostico, fig.cap="Pronósticos de los incentivos salariales según método de estimación"}
resumen_resultados(INCENTIVOS, fecha_inicio="2013-11-01", fecha_fin="2015-06-01")$pronostico %>% 
  rename("Método"=Serie) %>% 
  ggplot(., aes(x=fecha, y=valor, colour=Método))+
  geom_line(size = 0.8)+
  scale_color_manual(values=c("limegreen", "orangered1", "blue"))+
  theme_minimal() +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Contraloría General de la República de Costa Rica",
       y="Incentivos salariales",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_date(expand = c(0,0))+
  scale_y_continuous(expand=c(0, 0))
```

\subsubsection{Intereses y comisiones del sector público}

Finalmente, se utiliza para este análisis la serie cronológica de los intereses y comisiones del sector público, que comprenden el pago de los intereses de la deuda del gobierno, esto es, las erogaciones de intereses y comisiones destinadas por las instituciones públicas para cubrir el pago a favor de terceras personas, físicas o jurídicas, del sector privado o del sector público, residentes en el territorio nacional o en el exterior, por la utilización en un determinado plazo de recursos financieros provenientes de los conceptos de emisión y colocación de títulos valores, contratación de préstamos directos, créditos de proveedores, depósitos a plazo y a la vista, intereses por deudas de avales asumidos, entre otros pasivos de la entidad tranzados en el país o en el exterior. Incluye el pago por concepto de otras obligaciones contraídas entre las partes, que no provienen de las actividades normales de financiamiento. Además, los intereses y comisiones por las operaciones normales de los bancos comerciales del sector público, así como las diferencias por tipo de cambio por operaciones financieras; y también el pago de intereses moratorios correspondientes a la deuda pública. 

Para iniciar el análisis exploratorio de esta serie, la figura \ref{fig:interesesplotgeneral} muestra que hay un ligero cambio de concavidad a partir de Julio 2010, esto sugiere que a partir de este momento los intereses y comisiones inician una tendencia al alza, la cual se sostiene hasta Junio del 2018. Por su parte, la figura \ref{fig:interesesplotperiodos} muestra cómo hay un crecimiento sostenido de los intereses y comisiones del sector público al final de cada trimestre durante todo el periodo, mientras que se mantiene casi constante durante los primeros dos meses de cada trimestre. La caída más pronunciada se dio en abril del 2015 mientras que la tasa de crecimiento más rápida parece darse al final del primer trimestre. Además, en la figura \ref{fig:interesesplotdescomposicion} se muestra la descomposición de la serie en sus distintos componentes. Puede observarse, además de un crecimiento a lo largo del tiempo posterior a una disminución, los picos y las caídas en la parte estacional, esto en cuanto a los cierres trimestrales previamente mencionados. El componente aleatorio muestra indicios de que la variabilidad de la serie no es homogénea, sino que cambia conforme pasa el tiempo, pues durante un tiempo se mantuvo relativamente estable pero luego presenta algunos cambios.

```{r}
base <- popstudy::read_from_dir("Datos examen2.xlsx", "References/Results_section_references/05 - Intereses y comisiones del sector público") %>% 
  read_excel() %>%
  #read_excel(".\\Material de referencia\\Para sección de resultados\\05 - Intereses y comisiones del sector público\\Datos examen2.xlsx") %>% 
  mutate(valor=`Intereses y comisiones`,
         fecha=ymd(Fecha)) %>% 
  select(fecha, valor) %>% 
  filter(year(fecha)>=2009)
TS <- ts(base$valor, start = c(2009, 1), end = c(2018, 06), frequency = 12)
```

```{r interesesplotgeneral, fig.cap="Intereses y comisiones del sector público en el periodo 2007−2018"}
ggplot(TS)+
  geom_line(color = "#00AFBB", size = 1.3) +
  stat_smooth(color = "#FC4E07", fill = "#FC4E07",
              method = "loess")+
  theme_minimal() +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Contraloría General de la República de Costa Rica",
       y="Intereses y comisiones del sector público",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))
```

```{r interesesplotperiodos, fig.cap="Intereses y comisiones del sector público en el periodo 2007−2018 según mes"}
base %>% 
  group_by(año=year(fecha), mes=month(fecha, label = TRUE, abbr=FALSE)) %>% 
  summarise(valor) %>% 
  ggplot(., aes(x=año, y=valor)) +
  facet_wrap(.~mes, ncol=3) +
  geom_line(color = "#00AFBB", size = 1.3) +
  stat_peaks(colour = "red") +
  stat_peaks(geom = "text", colour = "red", 
             vjust = -0.5) +
  stat_valleys(colour = "blue") +
  stat_valleys(geom = "text", colour = "blue", angle = 20,
               vjust = 0.1, hjust = 1) +
  theme_minimal() +
  theme(text = element_text(size=13),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Contraloría General de la República de Costa Rica",
       y="Intereses y comisiones del sector público",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_discrete(expand = c(0,0), limits=c(2005, 2010, 2015))
```

En la figura \ref{fig:interesesplotdescomposicion} se muestra la descomposición de la serie en sus distintos componentes. Pueden observarse, además de un crecimiento a lo largo del tiempo posterior a una disminución, los picos y las caídas en la parte estacional. El componente aleatorio muestra indicios de que la variabilidad de la serie no es homogénea, sino que cambia conforme pasa el tiempo, pues durante un tiempo se mantuvo relativamente estable pero luego presenta algunos cambios.

```{r interesesplotdescomposicion, fig.cap="Descomposición de la serie de Incentivos salariales en el periodo 2007 − 2018"}
base %>% 
  mutate(valor=BoxCox(valor, lambda=1)) %>% 
ggsdc(., aes(x = fecha, y = valor),
         method = "stl", s.window = 7, frequency = 12, type="multiplicative",
         facet.titles = c("Serie Original", "Tendencia", 
                          "Estacionalidad", "Aleatoria")) +
      geom_line(color = "#00AFBB", size = 1.3) +
  labs(x = "", y = "") +
  theme_minimal() +
  theme(text = element_text(size=13),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Contraloría General de la República de Costa Rica") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10)))
```

Por último, los modelos ajustados para pronosticar los intereses y comisiones del sector público con un $ARIMA(0,0,1)(0,1,0)_{12}$ para el caso de la función `auto.arima()`; y un $ARIMA(0,1,2)(0,1,0)_{12}$ En este caso, la sobreparametrización es superior en dos de las tres medidas de rendimiento tal y como muestra el cuadro \ref{tab:interesesmedidas}, mientras que la figura \ref{fig:interesesplotpronostico} muestra de manera gráfica los pronósticos obtenidos, que son bastante similares pues ambos modelos difieren solamente en un parámetro para la parte estacional.

```{r}
resumen_resultados(INTERESES, fecha_inicio="2016-08-01", fecha_fin="2018-06-01")$medidas %>% 
  kbl(., "latex", booktabs=T, escape = F, align = "r", caption="\\label{tab:interesesmedidas}Medidas de rendimiento según método de estimación para los intereses y comisiones del sector público", col.names = c("Método", "RMSE", "MAE", "MAPE")) %>%
    kable_styling(latex_options = c("scale_down", "repeat_header", "hold_position"), 
                  full_width = T#, font_size = 5
                  )
```

```{r interesesplotpronostico, fig.cap="Pronósticos de los intereses y comisiones del sector público según método de estimación"}
resumen_resultados(INTERESES, fecha_inicio="2016-08-01", fecha_fin="2018-06-01")$pronostico %>% 
  rename("Método"=Serie) %>% 
  ggplot(., aes(x=fecha, y=valor, colour=Método))+
  geom_line(size = 0.8)+
  scale_color_manual(values=c("limegreen", "orangered1", "blue"))+
  theme_minimal() +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle=0, hjust=1)) +
  labs(caption="Fuente: Contraloría General de la República de Costa Rica",
       y="Intereses y comisiones del sector público",
       x="Año") +
  theme(plot.title = element_text(hjust = 0.5, face="plain"),
        plot.caption=element_text(hjust=0, vjust=0.5,
                                  margin=margin(t=1,10,10,10))) +
  scale_x_date(expand = c(0,0))+
  scale_y_continuous(expand=c(0, 0))
```

